CppFileEmbedder
===============

Last revision: 2014-08-03 by gygax@practicomp.ch

Simple C++ header file generator that embeds files and makes them available through a map object.

How to use
----------

### Generating the header file

Invoke the tool like this:

``CppFileEmbedder <headerfile> <resource files>``

This will generate a C++ header file that defines a static object called `embeds`.

### Using the header file

The header file generated by CppFileEmbedder is intended to be included in a single translation unit (source file). It is not guarded against multiple inclusion.

In one of your source files, include it simply like this:

```C++
#include "my_embedded_files.hpp"
```

### Accessing the embedded files

The `embeds` object gives access to contained files through an overloaded `[]` operator, which must be passed one of the exact filenames or paths that were specified as resource files when executing CppFileEmbedder.

It returns objects with two getter methods:

- `size()`, returning the size of the file in bytes
- `data<T>()`, returning a pointer to a (const) array of elements of the specified template type `T`

### Installing

The CppFileEmbedder project is managed by [CMake](http://www.cmake.org/), which is also the best way to install it.

To do so:

- Get the source from Github at https://github.com/JPGygax68/CppFileEmbedder
- Create a subdirectory called `build` and create or direct a shell there
- Generate the project configuration by executing `cmake ../src -DCMAKE_INSTALL_PREFIX=<your install directory>`

Specifying the ``CMAKE_INSTALL_PREFIX`` variable is mandatory. Usually, you should make it point to a directory you have set aside to hold software modules that you build from source yourself. Under Windows, for example, you might use ``D:/Libraries`` (forward slash! CMake cannot cope with backslashes), which would result in files being installed to ``D:\Libraries\bin\`` (the executable) and ``D:\Libraries\cmake\`` (the CMake export file - see below).

From there, as usual with CMake, you can build the utility by executing `cmake --build .`,  and install it with `cmake --build --target install`. Alternatively, you can also use your C++ toolchain directly.

### Using from CMake

CppFileEmbedder is not just built with CMake, it is also intended to be integrated into CMake-based build environments.

To this end, the ``install`` target installs CMake export files to ``${CMAKE_INSTALL_PREFIX}/cmake/``, called ``CppFileEmbedder-targets.cmake`` and ``CppFileEmbedder-targets-debug.cmake``.

Using the tool from your own ``CMakeLists.txt`` is easy. 

-   Use `find_file()` to locate the export file, followed by `include()`, e.g.:
    
    ```cmake
    find_file(CppFileEmbedder_CMAKE cmake/CppFileEmbedder-targets.cmake)
    include(${CppFileEmbedder_CMAKE})
    ```

-   Use a custom command to execute CppFileEmbedder, e.g.:

    ```cmake
    set(MY_EMBEDDABLE_FILES embeddable/file1.xyz embeddable/file2.bin)
    add_custom_command(
      OUTPUT generated/my_embedded_files.hpp
      COMMAND CppFileEmbedder generated/my_embedded_files.hpp ${MY_EMBEDDABLE_FILES} 
      DEPENDS ${MY_EMBEDDABLE_FILES}
      WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
    )
    ```
    
    (You will generally want your generated file to be in a subdirectory of your `build` directory; in this example, we use     `generated`).
    
-   Do not forget to inform the compiler about the `generated` directory, e.g.:

    ```CMake
    include_directories(${CMAKE_BINARY_DIR}/generated)
    ```
    
    This will allow you to include the header file without having to hardcode a relative path.
    
With this in place, your embedding header file will be generated automatically, provided you list it as a dependency for one of your targets.

### Final words

This utility is being used in its current state in an experimental project, but is otherwise to be considered in infant stage, if that. I would however love to get feedback on it, and will try to fix bugs and mistakes if reported.

Enjoy!
